language: cpp
os: osx
osx_image: xcode7.3
env:
        - PYTHON=/usr/local/bin/python
          JPEG=/usr/local/opt/mozjpeg
          PKG_CONFIG_PATH=/usr/local/opt/libffi/lib/pkgconfig
          JOBS="`sysctl -n hw.ncpu`"
          PATH="/usr/local/opt/ccache/libexec:$PATH"
cache: ccache
before_install:
        - brew tap homebrew/science
        - brew update
        - brew install ccache pkg-config automake
        - brew install --ignore-dependencies gtk-doc
        - brew reinstall
          gobject-introspection
          fftw mozjpeg libexif
          libpng webp libtiff
          swig imagemagick
          cfitsio libmatio
          orc little-cms2 poppler
          pango libgsf openslide
          librsvg giflib openexr
          python pygobject3
          gexiv2 gtk+ pygtk gtkmm 
          gtk-mac-integration
          

before_script:
  - brew info gtk-mac-integration
  - cd build
  - git clone -b v8.4.2 --depth 1 https://github.com/jcupitt/libvips.git libvips
  - cd libvips
  - ./autogen.sh
    --disable-dependency-tracking
    --with-jpeg-includes=$JPEG/include
    --with-jpeg-libraries=$JPEG/lib
  - make -j$JOBS -s V=0
  - make install
  - cd ..
  - rm -rf libvips
  - cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr/local -DINSTALL_PREFIX=/usr/local -DBUNDLED_LENSFUN=ON ..
  - make -j2
script:
  - make install
